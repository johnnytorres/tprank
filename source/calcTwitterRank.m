function r = calcTwitterRank(profiles, links, sim)  transition_matrix = double(links);  num_nodes = size(transition_matrix,1);  % calc topic similarity to the first or follower  for i=1:num_nodes    % get num tweets of friends    nTweetsFriends = sum(profiles((links(:,i)==1),2));    nTweetsFriends = nTweetsFriends+(nTweetsFriends==0); %avoid division by zero ->NaN    % calc sim         %set each user tweets    transition_matrix(:,i) = profiles(:,2).*links(:,i);    transition_matrix(:,i) = (transition_matrix(:,i) / nTweetsFriends).*sim;    nodes_weight = sum(transition_matrix(:,i));    nodes_weight = nodes_weight+(nodes_weight ==0); %avoid NaN    transition_matrix(:,i) = transition_matrix(:,i)/nodes_weight;  end  r = ones(num_nodes, 1);  r = r / num_nodes;    %e = ones(num_nodes,1) / num_nodes;  beta = 0.85;  for i=1:50    r = beta * transition_matrix*r + (1-beta)*sim;  endend